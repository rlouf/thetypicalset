<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-12-01 Thu 14:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>miniKanren in Python</title>
<meta name="author" content="RÃ©mi Louf" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="style.css" /><script data-goatcounter="https://thetypicalset.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">miniKanren in Python</h1>
<p>
In this article I will give an overview of the <code>kanren</code> library which is an implementation of miniKanren in python. We will go over the library's design. We assume that we are able to define <code>unify</code> and <code>reify</code> functions.
</p>

<div id="outline-container-org3132bda" class="outline-2">
<h2 id="org3132bda">Goals</h2>
<div class="outline-text-2" id="text-org3132bda">
<p>
In <code>kanren</code> we wish to express relations between variables with <i>goals</i>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">relation</span>(s, t):
    <span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">relation_goal</span>(s):
        <span style="color: #d73a49;">pass</span>
    <span style="color: #d73a49;">pass</span>
</pre>
</div>

<p>
The simplest example of this is the <code>eq</code> relation, which specifies that two variables must unify:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #d73a49;">from</span> unification <span style="color: #d73a49;">import</span> unify, reify, var

<span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">eq</span>(u, v):
    <span style="color: #6a737d;"># </span><span style="color: #6a737d;">u and v are two variables. They can be python variables or logic variables</span>

    <span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">eq_goal</span>(s):
        <span style="color: #24292e;">s</span> = unify(u, v, s)
        <span style="color: #d73a49;">if</span> s <span style="color: #d73a49;">is</span> <span style="color: #d73a49;">not</span> <span style="color: #005cc5;">False</span>:
            <span style="color: #d73a49;">return</span> <span style="color: #d73a49;">iter</span>((s,))
        <span style="color: #d73a49;">else</span>:
            <span style="color: #d73a49;">return</span> <span style="color: #d73a49;">iter</span>(())

    <span style="color: #d73a49;">return</span> eq_goal
</pre>
</div>

<p>
Initial state is the empty dictionary <code>{}</code>. Then what <code>run</code> does is reifying the input variable with whatever
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #24292e;">q</span> = var(<span style="color: #032f62;">'q'</span>)
<span style="color: #24292e;">goal</span> = eq(q, 1)
<span style="color: #24292e;">res</span> = <span style="color: #d73a49;">next</span>(goal({}))
reify(q, res)
</pre>
</div>

<p>
is equivalent to the following:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #d73a49;">from</span> kanren <span style="color: #d73a49;">import</span> var, run, eq

<span style="color: #24292e;">q</span> = var(<span style="color: #032f62;">'q'</span>)
<span style="color: #24292e;">res</span> = run(0, q, eq(q, 1.))
<span style="color: #d73a49;">print</span>(res[0])
</pre>
</div>

<p>
So far so good, nothing exceptional here. Difficulty comes when we add logic to combine goals.
</p>
</div>
</div>

<div id="outline-container-orgc5787c2" class="outline-2">
<h2 id="orgc5787c2">Combining goals</h2>
<div class="outline-text-2" id="text-orgc5787c2">
</div>
<div id="outline-container-orgaa20f21" class="outline-3">
<h3 id="orgaa20f21">Conjunction of goals</h3>
<div class="outline-text-3" id="text-orgaa20f21">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">conj</span>(goal1, goal2):

    <span style="color: #d73a49;">def</span> <span style="color: #6f42c1;">and_goal</span>(S):
        <span style="color: #24292e;">S1</span> = goal1(S)
        <span style="color: #d73a49;">yield</span> <span style="color: #d73a49;">from</span> <span style="color: #d73a49;">map</span>(goal2, S1)

    <span style="color: #d73a49;">return</span> and_goal
</pre>
</div>

<p>
So we can now use our <code>eq</code> operator defined above. This is where the possibility to pass a <code>state</code> to <code>unify</code> shows its usefulness:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #24292e;">goal1</span> = eq(q, 2)
<span style="color: #24292e;">goal2</span> = eq(q, 3)

<span style="color: #24292e;">state1</span> = <span style="color: #d73a49;">next</span>(goal1({}))
<span style="color: #d73a49;">print</span>(state1)

<span style="color: #24292e;">state2</span> = <span style="color: #d73a49;">next</span>(goal2({}))
<span style="color: #d73a49;">print</span>(state2)

<span style="color: #d73a49;">print</span>(<span style="color: #d73a49;">next</span>(goal2({q: 3})))
<span style="color: #d73a49;">print</span>(<span style="color: #d73a49;">next</span>(goal2({q: 2})))
</pre>
</div>

<p>
Yep, if the state is incompatible then the iterator has nothing to offer. This looks like the following:
</p>

<div class="org-src-container">
<pre class="src src-ascii">| goal1 | ---&gt; unified state1 ---&gt; | goal2 | ---&gt; unified state compatible with state1
</pre>
</div>

<p>
<i>Unify does all the work here</i>.
</p>
</div>
</div>

<div id="outline-container-org558e1cd" class="outline-3">
<h3 id="org558e1cd">Disjunctions of goals</h3>
<div class="outline-text-3" id="text-org558e1cd">
<p>
Here we just interleave results. Both branches are contributing possible states. The current implementation uses a naive interleaving mechanism.
</p>
</div>
</div>

<div id="outline-container-org5ab1972" class="outline-3">
<h3 id="org5ab1972">Conditional</h3>
</div>
<div id="outline-container-org565eaa1" class="outline-3">
<h3 id="org565eaa1">Negations</h3>
</div>
</div>
</div>
</body>
</html>