<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-01-01 Mon 16:44 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>API design</title>
<meta name="author" content="RÃ©mi Louf" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="style.css" /><script data-goatcounter="https://thetypicalset.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">API design</h1>

<div id="outline-container-orgb013ceb" class="outline-2">
<h2 id="orgb013ceb">A little friction in your design is good.</h2>
<div class="outline-text-2" id="text-orgb013ceb">
<p>
In python there are two ways to enforce this. First with keyword-only arguments:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">function</span>(a, **, new, this):
    <span style="color: #F0DFAF; font-weight: bold;">pass</span>

function(0, new=1, this=2)
</pre>
</div>

<p>
Then with namedtuples or dataclasses:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Parameters</span>(NamedTuple):
    a: <span style="color: #DCDCCC; font-weight: bold;">int</span>
    b: <span style="color: #DCDCCC; font-weight: bold;">str</span>

<span style="color: #7CB8BB;">@dataclass</span>
<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Parameters</span>:
    a: <span style="color: #DCDCCC; font-weight: bold;">int</span>
    b: <span style="color: #DCDCCC; font-weight: bold;">str</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org39b0a67" class="outline-2">
<h2 id="org39b0a67">Avoid **kwargs at all cost</h2>
<div class="outline-text-2" id="text-org39b0a67">
<p>
They are hard to document. Use dataclasses or namedtuples instead (similar to the Go way of doing things). This also has the advantage of putting the emphasis on your data structure, the interface with the outside world. A way to control the data (can add validation when initializing a dataclass for instance)
</p>
</div>
</div>

<div id="outline-container-org8797687" class="outline-2">
<h2 id="org8797687">Difference between a framework and a library</h2>
<div class="outline-text-2" id="text-org8797687">
<ul class="org-ul">
<li>Designed to do specific things</li>
<li>Composes with other libraries (composability)</li>
<li>Modularity</li>
<li>Framework already contain the base flow &amp; architecture of the application you're building (Flask vs http library)</li>
</ul>
</div>
</div>

<div id="outline-container-orge292847" class="outline-2">
<h2 id="orge292847">Build the conceptually right thing first, the abstraction later</h2>
</div>
<div id="outline-container-org2cb2369" class="outline-2">
<h2 id="org2cb2369">Naming is 90% of the work</h2>
<div class="outline-text-2" id="text-org2cb2369">
<p>
Take it seriously.
</p>
</div>
</div>

<div id="outline-container-org4c40329" class="outline-2">
<h2 id="org4c40329">Always be thinking "How much documentation am I going to have to write for this?"</h2>
<div class="outline-text-2" id="text-org4c40329">
<p>
This is linked to naming. Ideally function name and name of the arguments should suffice.
</p>
</div>
</div>

<div id="outline-container-orgd3f19fc" class="outline-2">
<h2 id="orgd3f19fc">Writig the function is only 50% of the work</h2>
<div class="outline-text-2" id="text-orgd3f19fc">
<p>
This is junior's most frequent error. Once the code has been written they consider their job done. But you need to keep re-writing the code until it makes sense to someone else.
</p>
</div>
</div>

<div id="outline-container-orgcece97c" class="outline-2">
<h2 id="orgcece97c">Programming is <i>writing</i></h2>
<div class="outline-text-2" id="text-orgcece97c">
<p>
Hunmanities students make better programmers. Stop thinking of programming as a scientific discipline (I mean it slightly is for machine learning). You are <i>writing</i>.
</p>
</div>
</div>

<div id="outline-container-org52a2017" class="outline-2">
<h2 id="org52a2017">But mostly <i>reading</i></h2>
<div class="outline-text-2" id="text-org52a2017">
<p>
Code is read more often than written.
</p>
</div>
</div>

<div id="outline-container-org0c4d3aa" class="outline-2">
<h2 id="org0c4d3aa">OOP is usually the path to broken abstractions</h2>
<div class="outline-text-2" id="text-org0c4d3aa">
<p>
When you create objects, you are populating a world. Bad APIs create a fantasy world, a collections of objects that have no bearing on reality.
</p>

<p>
Is Machine Learning really about creating objects? What's an algorithm? Can you eat it?
</p>

<p>
"There is an object X that does Y" vs "When I take X and apply this transformation I get Z" Stateless. If I run it twice with the same input it gives me the same result.
</p>

<p>
Sometimes combinations of transformations are useful and we give them a name: a new object or a new function.
</p>
</div>
</div>

<div id="outline-container-org01efd03" class="outline-2">
<h2 id="org01efd03">What are you preventing your users from doing?</h2>
<div class="outline-text-2" id="text-org01efd03">
<p>
We are often thinking in terms of what our API allows users to do, less in terms about what it prevents them from doing. In some cases creating a sandbox is good (framework), but sometimes it is frustrating (library).
</p>
</div>
</div>
<div id="outline-container-org044fc51" class="outline-2">
<h2 id="org044fc51">You need to have trap doors, way to escape your leaky abstractions</h2>
<div class="outline-text-2" id="text-org044fc51">
<p>
The Julia language is great with that. You can always act on the abstraction layer below.
</p>
</div>
</div>
<div id="outline-container-orga67ca0b" class="outline-2">
<h2 id="orga67ca0b">A model is a combination of arrays and operations on arrays.</h2>
<div class="outline-text-2" id="text-orga67ca0b">
<p>
Write that first.
</p>
</div>
</div>
<div id="outline-container-orgdc1bd1d" class="outline-2">
<h2 id="orgdc1bd1d">API = abstraction. All abstractions suck.</h2>
</div>
<div id="outline-container-org1e38a2f" class="outline-2">
<h2 id="org1e38a2f">Naming</h2>
<div class="outline-text-2" id="text-org1e38a2f">
<p>
There is a joke in CS that naming is the hardest thing in programming along with cache invalidation. Except it is not a joke. Naming is hard, and good names go a loooong way.
</p>

<p>
Why do poiticians use vague terms? Allow people to project whatever people want on them. Don't code like a politician. Be pedantic.
</p>
</div>
</div>

<div id="outline-container-org01c8c80" class="outline-2">
<h2 id="org01c8c80">Favorite APIs</h2>
<div class="outline-text-2" id="text-org01c8c80">
<ul class="org-ul">
<li><code>numpy</code>, I rarely have any surprises with functions I discover for the first time;</li>
<li><code>schedule</code></li>
<li><code>jax</code></li>
</ul>
</div>
</div>

<div id="outline-container-orga3b19c9" class="outline-2">
<h2 id="orga3b19c9">Choose COMPOSITION OVER CONFIGURATION</h2>
</div>
<div id="outline-container-org426b87e" class="outline-2">
<h2 id="org426b87e">Interchangeable elements should have the same signature</h2>
</div>
<div id="outline-container-orgda57dc2" class="outline-2">
<h2 id="orgda57dc2">Please do not reinvent the wheel!</h2>
<div class="outline-text-2" id="text-orgda57dc2">
<p>
In doubt do like numpy. Example of theano is partially hard to use because it uses different naming and type casting conventions.
</p>

<p>
You are not going to do better than numpy; if you do <b>no one</b> will adopt your conventions.
</p>

<p>
<code>import jax.numpy as jnp</code> and <code>import theano.tensor as tt</code>
</p>

<p>
JAX feels like the natural extension of numpy to which it adds:
</p>
<ul class="org-ul">
<li>JIT-compilation <code>jax.jit(fn)</code></li>
<li>SIMD mapping <code>jax.vmap(fn)</code> or <code>jax.pmap(fn)</code></li>
<li>forward and backward autodiff: <code>jax.grad(fn)</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">function</span>(x):
    <span style="color: #DFAF8F;">y</span> = jnp.exp(x)
    <span style="color: #F0DFAF; font-weight: bold;">return</span> y
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacfc1ee" class="outline-2">
<h2 id="orgacfc1ee">Modular internals may not make a difference to end users, but it does to maintainer. Do not only think about the user!</h2>
</div>

<div id="outline-container-org09e2183" class="outline-2">
<h2 id="org09e2183">Links to this note</h2>
<div class="outline-text-2" id="text-org09e2183">
<ul class="org-ul">
<li><a href="./inbox.html">Writing inbox</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>
