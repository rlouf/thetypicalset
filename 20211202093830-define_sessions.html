<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-08-23 Tue 22:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Define user sessions in mobile applications</title>
<meta name="author" content="RÃ©mi Louf" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="style.css" /><script data-goatcounter="https://thetypicalset.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Define user sessions in mobile applications</h1>
<p>
No one really know how to define what a <i>session</i> in a mobile app is, and it is indeed something that is hard to define. Here is a real inter-event time distribution for the iOS and Android version of the same mobile application:
</p>


<div id="org40a6e15" class="figure">
<p><img src="images/session-length.png" alt="session-length.png" />
</p>
</div>

<p>
We call \(T\) the random variable that represents the inter-event time. We found \(\min(t) = 8 \text{ms}\) and \(\max(t) = 6 \text{months}\). Worse, \(\mathbb{E}[T_{android}] = 2\, \mathbb{E}[T_{iOS}]\). Is it possible to find a way to delineate sessions that gives consistant results across platforms?
</p>

<p>
The key is to realize that the above distributions are the results of different processes:
</p>
<ul class="org-ul">
<li>Actions within a session. We note the inter-action time \(T_{actions}\)</li>
<li>Leaving the session and coming back to the application at a later time. We note the inter-session time \(T_{sesssion}\)</li>
</ul>

<p>
It is known that the inter-event time between human actions such as responding to emails follows a Pareto distribution so we will assume that the inter-session time follows a Pareto distribution:
</p>

<p>
We will assume a distribution with shorter tails yet flexible for inter-actions times:
</p>

<p>
So the inter-event time \(T\) in the data is given by a mixture:
</p>

\begin{equation}
  P(T|k,\theta,\alpha) = \omega_{a}\, P(T_{action}|k,\theta) + \omega_{s}\, P(T_{session}|\alpha)
\end{equation}

<p>
The implementation in PyMC3 is straightforward:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> pymc3 <span style="font-weight: bold;">as</span> pm
<span style="font-weight: bold;">import</span> numpy <span style="font-weight: bold;">as</span> np

<span style="font-weight: bold; font-style: italic;">data</span> = [insert, your, inter, event, time, data, here]

<span style="font-weight: bold;">with</span> pm.Model() <span style="font-weight: bold;">as</span> mixture_model:

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Define priors</span>
    <span style="font-weight: bold; font-style: italic;">BoundedNormal</span> = pm.Bound(pm.Normal, lower=0.0)
    <span style="font-weight: bold; font-style: italic;">k</span> = BoundedNormal(<span style="font-style: italic;">'k'</span>, mu=20, sd=np.sqrt(data.var()), testval=20)
    <span style="font-weight: bold; font-style: italic;">theta</span> = pm.HalfCauchy(<span style="font-style: italic;">'theta'</span>, 5)
    <span style="font-weight: bold; font-style: italic;">alpha</span> = pm.HalfNormal(<span style="font-style: italic;">'alpha'</span>, 5)


    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Likelihood</span>
    <span style="font-weight: bold; font-style: italic;">gamma</span> = pm.Gamma.dist(mu=k, sd=theta)
    <span style="font-weight: bold; font-style: italic;">pareto</span> = pm.Pareto.dist(alpha=alpha, m=0.1)
    <span style="font-weight: bold; font-style: italic;">w</span> = pm.Dirichlet(<span style="font-style: italic;">'weight'</span>, a=np.array([1, 1]))
    <span style="font-weight: bold; font-style: italic;">interval_obs</span> = pm.Mixture(<span style="font-style: italic;">'interval_obs'</span>, w=w, comp_dists=[gamma,pareto], observed=data)

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Inference</span>
    <span style="font-weight: bold; font-style: italic;">trace</span> = pm.sample()

</pre>
</div>

<p>
To delineate sessions we need to find a time scale \(\Delta t\) such that if no actions has been performed since more than \(\Delta t\) we consider the session to be over. We look for the maximum value of \(\Delta t\) such that:
</p>

\begin{equation}
  P(T = \Delta t| inter-actions) > \epsilon\:P(T = \Delta t| inter-sessions)
\end{equation}

<p>
Where \(\epsilon\) is a constant to dermine (we can probably use decision theory for that). Choosing \(\epsilon=1\) we found the following posterior distribution for \(\Delta t\):
</p>


<div id="orgb57155d" class="figure">
<p><img src="images/session-length-delta-t.png" alt="session-length-delta-t.png" />
</p>
</div>

<p>
In other words, we will consider that a session is still active as long as \(\Delta t < 55s\). We can now take the users' timeline of events, extract sessions using the \(\Delta t\) threshold, and look at the distribution of session duration of all users. We find that for sessions &gt; 10s the distributions for iOS and Android users match almost perfectly:
</p>


<div id="orgc587f7e" class="figure">
<p><img src="images/session-length-model.png" alt="session-length-model.png" />
</p>
</div>

<p>
Of course there are details to iron out. The definition could be improved by discarding "noise" events (that lead to these very short inter-action times) but the main idea (using a mixture) is here.
</p>

<div id="outline-container-orgbe6d225" class="outline-2">
<h2 id="orgbe6d225">Links to this note</h2>
<div class="outline-text-2" id="text-orgbe6d225">
<ul class="org-ul">
<li><a href="./20211202091119-how_to_define_urban_areas.html">How to define urban areas</a></li>
<li><a href="./20211125144125-bayesian_statistics.html">Bayesian statistics</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>
