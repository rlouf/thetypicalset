<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-06 Wed 09:54 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Define user sessions in mobile applications</title>
<meta name="author" content="RÃ©mi Louf" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="style.css" /><script data-goatcounter="https://thetypicalset.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Define user sessions in mobile applications</h1>
<p>
No one really know how to define what a <i>session</i> in a mobile app is, and it is indeed something that is hard to define. Here is a real inter-event time distribution for the iOS and Android version of the same mobile application:
</p>


<div id="orgc52a8a2" class="figure">
<p><img src="images/session-length.png" alt="session-length.png" />
</p>
</div>

<p>
We call \(T\) the random variable that represents the inter-event time. We found \(\min(t) = 8 \text{ms}\) and \(\max(t) = 6 \text{months}\). Worse, \(\mathbb{E}[T_{android}] = 2\, \mathbb{E}[T_{iOS}]\). Is it possible to find a way to delineate sessions that gives consistant results across platforms?
</p>

<p>
The key is to realize that the above distributions are the results of different processes:
</p>
<ul class="org-ul">
<li>Actions within a session. We note the inter-action time \(T_{actions}\)</li>
<li>Leaving the session and coming back to the application at a later time. We note the inter-session time \(T_{sesssion}\)</li>
</ul>

<p>
It is known that the inter-event time between human actions such as responding to emails follows a Pareto distribution so we will assume that the inter-session time follows a Pareto distribution:
</p>

<div class="org-src-container">
<pre class="src src-latex"><span style="font-weight: bold;">\begin</span>{<span style="font-weight: bold;">equation</span>}
  T_{session} <span style="font-weight: bold;">\sim</span> <span style="font-weight: bold;">\operatorname</span>{Pareto}(<span style="font-weight: bold;">\alpha</span>)
<span style="font-weight: bold;">\end</span>{<span style="font-weight: bold;">equation</span>}
</pre>
</div>

<p>
We will assume a distribution with shorter tails yet flexible for inter-actions times:
</p>

<div class="org-src-container">
<pre class="src src-latex"><span style="font-weight: bold;">\begin</span>{<span style="font-weight: bold;">equation</span>}
 T_{action} <span style="font-weight: bold;">\sim</span> <span style="font-weight: bold;">\operatorname</span>{Gamma}(k, <span style="font-weight: bold;">\theta</span>)
<span style="font-weight: bold;">\end</span>{<span style="font-weight: bold;">equation</span>}
</pre>
</div>

<p>
So the inter-event time \(T\) in the data is given by a mixture:
</p>

<div class="org-src-container">
<pre class="src src-latex"><span style="font-weight: bold;">\begin</span>{<span style="font-weight: bold;">equation</span>}
  P(T|k,<span style="font-weight: bold;">\theta</span>,<span style="font-weight: bold;">\alpha</span>) = <span style="font-weight: bold;">\omega</span>_{a}<span style="font-weight: bold;">\,</span> P(T_{action}|k,<span style="font-weight: bold;">\theta</span>) + <span style="font-weight: bold;">\omega</span>_{s}<span style="font-weight: bold;">\,</span> P(T_{session}|<span style="font-weight: bold;">\alpha</span>)
<span style="font-weight: bold;">\end</span>{<span style="font-weight: bold;">equation</span>}
</pre>
</div>

\begin{equation}
  P(T|k,\theta,\alpha) = \omega_{a}\, P(T_{action}|k,\theta) + \omega_{s}\, P(T_{session}|\alpha)
\end{equation}

<p>
The implementation in PyMC3 is straightforward:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> pymc3 <span style="font-weight: bold;">as</span> pm
<span style="font-weight: bold;">import</span> numpy <span style="font-weight: bold;">as</span> np

<span style="font-weight: bold; font-style: italic;">data</span> = [insert, your, inter, event, time, data, here]

<span style="font-weight: bold;">with</span> pm.Model() <span style="font-weight: bold;">as</span> mixture_model:

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Define priors</span>
    <span style="font-weight: bold; font-style: italic;">BoundedNormal</span> = pm.Bound(pm.Normal, lower=0.0)
    <span style="font-weight: bold; font-style: italic;">k</span> = BoundedNormal(<span style="font-style: italic;">'k'</span>, mu=20, sd=np.sqrt(data.var()), testval=20)
    <span style="font-weight: bold; font-style: italic;">theta</span> = pm.HalfCauchy(<span style="font-style: italic;">'theta'</span>, 5)
    <span style="font-weight: bold; font-style: italic;">alpha</span> = pm.HalfNormal(<span style="font-style: italic;">'alpha'</span>, 5)


    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Likelihood</span>
    <span style="font-weight: bold; font-style: italic;">gamma</span> = pm.Gamma.dist(mu=k, sd=theta)
    <span style="font-weight: bold; font-style: italic;">pareto</span> = pm.Pareto.dist(alpha=alpha, m=0.1)
    <span style="font-weight: bold; font-style: italic;">w</span> = pm.Dirichlet(<span style="font-style: italic;">'weight'</span>, a=np.array([1, 1]))
    <span style="font-weight: bold; font-style: italic;">interval_obs</span> = pm.Mixture(<span style="font-style: italic;">'interval_obs'</span>, w=w, comp_dists=[gamma,pareto], observed=data)

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Inference</span>
    <span style="font-weight: bold; font-style: italic;">trace</span> = pm.sample()

</pre>
</div>

<p>
To delineate sessions we need to find a time scale \(\Delta t\) such that if no actions has been performed since more than \(\Delta t\) we consider the session to be over. We look for the maximum value of \(\Delta t\) such that:
</p>

<div class="org-src-container">
<pre class="src src-latex"><span style="font-weight: bold;">\begin</span>{<span style="font-weight: bold;">equation</span>}
  P(T = <span style="font-weight: bold;">\Delta</span> t| inter-actions) &gt; <span style="font-weight: bold;">\epsilon\:</span>P(T = <span style="font-weight: bold;">\Delta</span> t| inter-sessions)
<span style="font-weight: bold;">\end</span>{<span style="font-weight: bold;">equation</span>}
</pre>
</div>

\begin{equation}
  P(T = \Delta t| inter-actions) > \epsilon\:P(T = \Delta t| inter-sessions)
\end{equation}

<p>
Where \(\epsilon\) is a constant to dermine (we can probably use decision theory for that). Choosing \(\epsilon=1\) we found the following posterior distribution for \(\Delta t\):
</p>


<div id="org60ac266" class="figure">
<p><img src="images/session-length-delta-t.png" alt="session-length-delta-t.png" />
</p>
</div>

<p>
In other words, we will consider that a session is still active as long as \(\Delta t < 55s\). We can now take the users' timeline of events, extract sessions using the \(\Delta t\) threshold, and look at the distribution of session duration of all users. We find that for sessions &gt; 10s the distributions for iOS and Android users match almost perfectly:
</p>


<div id="org568cfee" class="figure">
<p><img src="images/session-length-model.png" alt="session-length-model.png" />
</p>
</div>

<p>
Of course there are details to iron out. The definition could be improved by discarding "noise" events (that lead to these very short inter-action times) but the main idea (using a mixture) is here.
</p>

<div id="outline-container-orge195fac" class="outline-2">
<h2 id="orge195fac">Links to this note</h2>
</div>
</div>
</body>
</html>
